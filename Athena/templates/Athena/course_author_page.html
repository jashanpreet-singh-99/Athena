{% extends 'Athena/base.html' %}
{% load static %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'Athena/css/course_author_page.css' %}"/>
{% endblock %}

{% block page %}
<div class="info-container">
        <img class="course-banner" src="{{ course.course_banner.url }}" alt="course_banner">
        <div class="course-content">
            <h2 class="course-title">{{ course.course_title }}</h2>
            <p class="course-desc">{{ course.course_desc }}</p>
            <div class="content-footer">
                <div class="author-card">
                    <img class="author-profile-image" src="{{ author_profile.url }}" alt="author_profile">
                    <p class="course-author"> {{ course.author.first_name }} {{ course.author.last_name }}</p>
                </div>
                <button class="enroll-button">Edit</button>
            </div>
        </div>
    </div>

    <div class="tabbed-view">
        <div class="tab-container">
            <button class="tab" onclick="openTab(event, 'tab1', 0)">Course Details</button>
            <button class="tab" onclick="openTab(event, 'tab2', 1)">Content</button>
            <button class="tab" onclick="openTab(event, 'tab3', 2)">Students</button>
            <button class="tab" onclick="openTab(event, 'tab4', 3)">Grades</button>
        </div>
        <div id="tab1" class="tab-content">
            <div class="course-content-dates">
                <div>
                    <h3>Course Created on: </h3>
                    <p>{{ course.course_created }}</p>
                </div>
                <div>
                    <h3>Course Difficulty Level: </h3>
                    <p>{{ course.get_course_difficulty_display }}</p>
                </div>
                <p class="secondary-info"> Last updated on {{ course.last_update }}
            </div>
            <div class="course-content-dates">
                <div>
                    <h3>Course Starts: </h3>
                    <p>{{ course.course_start_date }}</p>
                </div>
                <div>
                    <h3>Course Ends:</h3>
                    <p>{{ course.course_end_date }}</p>
                </div>
                <p class="secondary-info"> Duration: {{ course.course_start_date|timesince:course.course_end_date }}
            </div>
            <div class="course-content-dates">
                <div>
                    <h3>Course Medium: </h3>
                    <p>{{ course.get_course_type_display }}</p>
                </div>
                <div>
                    <h3>Instructor: </h3>
                    <div class="author-card">
                        <img class="author-profile-image" src="{{ author_profile.url }}" alt="author_profile">
                        <p class="course-author"> {{ course.author.first_name }} {{ course.author.last_name }}</p>
                    </div>
                </div>
                <p class="secondary-info"> Weekly: {{ course.course_day }}
            </div>
            <h3 class="cat-title">Content Covered</h3>
            <div id="cat-container"></div>
            <h3 class="cat-title">Class Enrollments: </h3>
            <p>{{ e_info|length }} Student{{ e_info|pluralize }}</p>
{#            {% if e_info|length < 2 %}#}
{#                <p>{{ e_info|length }} Student</p>#}
{#            {% else %}#}
{#                <p>{{ e_info|length }} Students</p>#}
{#            {% endif %}#}
            {%  url 'dash_page' %}
        </div>
        <div id="tab2" class="tab-content">
            <div class="content-p-container">
                <div class="content-header">
                    <h2>Chapters:</h2>
                    <div>
                        <button class="expand-button content-buttons light content-buttons-120" id="chapter-expand-btn">
                            Expand
                        </button>
                    </div>
                </div>
                <div id="content-container" class="content-container">
                    <form id="vis-form" method="post" action="{% url 'change_chapter_visibility' %}">
                        {% csrf_token %}
                        <input id="course_id-f" name="course" type="hidden" value="{{ course.id }}">
                        <input id="chapter_id-f" name="id" type="hidden" value="">
                        <input id="visibility-f-input" type="hidden" name="visibility" value="False">
                        <input id="mode-f-input" type="hidden" name="mode" value="Chapter">
                        <input id="scroll-f-input" type="hidden" name="page_scroll" value="0">
                    </form>
                    {% for chapter in chapters %}
                        <div class="chapter-view-container chapter-v-container">
                            <div class="chapter-info-container">
                                <span>{{ forloop.counter }}</span>
                                <p class="ch-title-info">{{ chapter.title }}</p>
                            </div>
                            <div class="chapter-info-container">
                                <div class="toggle-div">
                                    <button id="ch-visible-button" class="toggle-btn light sel">Visible</button>
                                    <button id="ch-hidden-button" class="toggle-btn light">Hidden</button>
                                </div>
                                {% if chapter.is_streaming %}
                                    <img width="36" height="36" src="https://img.icons8.com/ios/50/cinema---v1.png" alt="cinema---v1"/>
                                {% else %}
                                    <img width="36" height="36" src="https://img.icons8.com/ios/50/document--v1.png" alt="document--v1"/>
                                {% endif %}
                                <button class="content-buttons light no-mrg">Edit</button>
                            </div>
                        </div>
                    {%  endfor %}
                    <form method="post" enctype="multipart/form-data" action="{% url 'create_chapter' %}">
                        {%  csrf_token %}
                        <div>
                            <h3>Chapter Title: </h3>
                            {{ c_form.course }}
                            {{ c_form.title }}
                            {{ c_form.visibility }}
                            <div class="toggle-div">
                                <button id="visible-button" class="toggle-btn sel">Visible</button>
                                <button id="hidden-button" class="toggle-btn ">Hidden</button>
                            </div>
                            {{ c_form.is_streaming }}
                            <div class="toggle-div large">
                                <button id="stream-button" class="toggle-btn large">Stream-Only</button>
                                <button id="no-stream-button" class="toggle-btn large sel">No Stream</button>
                            </div>
                        </div>
                        <div id="stream_video_file_div">
                            {{ c_form.video_file }}
                        </div>
                        <div id="no_stream_video_file_div">
                            {{ c_form.files }}
                        </div>
                        <button class="content-buttons" type="submit">Add Chapter</button>
                    </form>
                </div>
            </div>
            <div class="content-p-container">
                <div class="content-header">
                    <h2>Quiz:</h2>
                    <div>
                        <button class="expand-button content-buttons light content-buttons-120">Expand</button>
                    </div>
                </div>
                <div id="content-container" class="content-container">
                    {% for quiz in quizzes %}
                        <div class="chapter-view-container quiz-v-container">
                            <div class="chapter-info-container">
                                    <span>{{ forloop.counter }}</span>
                                    <p class="ch-title-info">{{ quiz.title }}</p>
                            </div>
                            <div class="chapter-info-container">
                                <div class="toggle-div">
                                    <button id="q-visible-button" class="toggle-btn light sel">Visible</button>
                                    <button id="q-hidden-button" class="toggle-btn light">Hidden</button>
                                </div>
                            </div>
                        </div>
                    {%  endfor %}
                    <form method="post" enctype="multipart/form-data" action="{%  url 'create_quiz' %}">
                        {% csrf_token %}
                        <div>
                            <h3>Quiz Title: </h3>
                            {{ q_form.course }}
                            {{ q_form.title }}
                            {{ q_form.visibility }}
                            <div class="toggle-div">
                                <button id="q-visible-button" class="toggle-btn sel">Visible</button>
                                <button id="q-hidden-button" class="toggle-btn ">Hidden</button>
                            </div>
                            {{ q_form.negative_marking }}
                            <div class="toggle-div x-large">
                                <button id="n-allowed-button" class="toggle-btn x-large">Negative Marking</button>
                                <button id="n-not-allowed-button" class="toggle-btn sel x-large">Normal Marking</button>
                            </div>
                            {{ q_form.negative_grade }}
                        </div>
                        <div class="quiz_i_t_info">
                            <div class="instruction_container">
                                <h4>Instructions for Students: </h4>
                                {{ q_form.instructions }}
                            </div>
                            <div class="time_container">
                                <h4>Time Limit Defined in Minutes: </h4>
                                {{ q_form.time }}
                                <h4>Quiz Questions stored in File: </h4>
                                <div id="stream_video_file_div">
                                    {{ q_form.files }}
                                </div>
                            </div>
                        </div>
                        <div class="grade-area">
                            <div class="instruction_container">
                                    <h4>Mark per Question: </h4>
                                    {{ q_form.each_mark }}
                            </div>
                            <div class="instruction_container">
                                    <h4>Quiz Grading for Cumulative Score: </h4>
                                    {{ q_form.grade }}
                            </div>
                        </div>
                        <button class="content-buttons" type="submit">Add Quiz</button>
                    </form>
                </div>
            </div>
            <div class="content-p-container">
                <div class="content-header">
                    <h2>Assignments:</h2>
                    <div>
                        <button class="content-buttons content-buttons-200">
                            Add Assignment
                        </button>
                        <button class="expand-button content-buttons light content-buttons-120" id="assignment-expand-btn">
                            Expand
                        </button>
                    </div>
                </div>
                <div id="content-container" class="content-container">
                    <p>This is the expanded content Assignments.</p>
                </div>
            </div>
            <div class="content-p-container">
                <div class="content-header">
                    <h2>In-Person Exam:</h2>
                    <div>
                        <button class="content-buttons content-buttons-200">
                            Add Exam
                        </button>
                        <button class="expand-button content-buttons light content-buttons-120" id="exam-expand-btn">
                            Expand
                        </button>
                    </div>
                </div>
                <div id="content-container" class="content-container">
                    <p>This is the expanded content Assignments.</p>
                </div>
            </div>
        </div>
        <div id="tab3" class="tab-content">
            {% for students in e_info %}
                <div>
                    <p>{{ students.user.first_name }} {{ students.user.last_name }}</p>
                    <p>{{ students.user.email }}</p>
                </div>
            {% endfor %}
        </div>
        <div id="tab4" class="tab-content"></div>
    </div>
{% endblock %}

{% block extrascripts %}
    <script>
        const course_categories = '{{ course.categories }}';
        let chapters = [];
        {% for chapter in chapters %}
            var chap = {};
            chap['id'] = '{{ chapter.id|escapejs }}';
            chap['title'] = '{{ chapter.title|escapejs }}';
            chap['visibility'] = '{{ chapter.visibility|escapejs }}';
            chap['is_streaming'] = '{{ chapter.is_streaming|escapejs }}';
            chapters.push(chap);
        {% endfor %}
        let quizzes = [];
        {% for quiz in quizzes %}
            var q = {};
            q['id'] = '{{ quiz.id|escapejs }}';
            q['title'] = '{{ quiz.title|escapejs }}';
            q['visibility'] = '{{ quiz.visibility|escapejs }}';
            quizzes.push(q);
        {% endfor %}
        let page_scroll_y = '{{ page_scroll }}';
    </script>
    <script src="{% static 'Athena/js/course_author_page.js'%}"></script>
{% endblock %}